# æ–°ç–†ä¼ŠçŠæ—…æ¸¸è‡ªé©¾è·¯çº¿åœ°å›¾ - Dockeréƒ¨ç½²

## ğŸ“‹ é¡¹ç›®ç®€ä»‹

è¿™æ˜¯ä¸€ä¸ªåŸºäºDocker Composeçš„æ–°ç–†ä¼ŠçŠæ—…æ¸¸è‡ªé©¾è·¯çº¿åœ°å›¾WebæœåŠ¡ï¼Œæä¾›äº¤äº’å¼çš„æ—…æ¸¸è·¯çº¿å±•ç¤ºå’Œæ¯æ—¥è¡Œç¨‹è¯¦æƒ…æŸ¥çœ‹åŠŸèƒ½ã€‚

## ğŸš€ å¿«é€Ÿå¯åŠ¨

### æ–¹å¼ä¸€ï¼šä½¿ç”¨ start.sh è„šæœ¬ï¼ˆæ¨èï¼‰

é¡¹ç›®æä¾›äº†ä¾¿æ·çš„ `start.sh` è„šæœ¬æ¥ç®¡ç† Docker æœåŠ¡ï¼š

```bash
# ä¸€é”®å¯åŠ¨æœåŠ¡ï¼ˆæ¨èï¼‰
./start.sh

# æˆ–è€…ä½¿ç”¨å…¶ä»–å‘½ä»¤
./start.sh start    # å¯åŠ¨æœåŠ¡
./start.sh stop     # åœæ­¢æœåŠ¡
./start.sh restart  # é‡å¯æœåŠ¡
./start.sh status   # æŸ¥çœ‹çŠ¶æ€
./start.sh logs     # æŸ¥çœ‹æ—¥å¿—
./start.sh help     # æ˜¾ç¤ºå¸®åŠ©
```

**é¦–æ¬¡è¿è¡Œå‰ï¼Œè¯·ç¡®ä¿è„šæœ¬æœ‰æ‰§è¡Œæƒé™ï¼š**
```bash
chmod +x start.sh
```

### æ–¹å¼äºŒï¼šä½¿ç”¨ Docker Compose

```bash
# å¯åŠ¨æœåŠ¡ï¼ˆæŒ‡å®šé¡¹ç›®åç§°ï¼‰
docker-compose -p travel-plan up -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose -p travel-plan ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose -p travel-plan logs -f
```

### æ–¹å¼ä¸‰ï¼šä½¿ç”¨è‡ªå®šä¹‰é•œåƒ

```bash
# æ„å»ºé•œåƒ
docker build -t travel-plan .

# è¿è¡Œå®¹å™¨
docker run -d \
  --name travel-plan \
  -p 8080:80 \
  travel-plan
```

## ğŸŒ è®¿é—®åœ°å€

å¯åŠ¨æˆåŠŸåï¼Œå¯é€šè¿‡ä»¥ä¸‹åœ°å€è®¿é—®ï¼š

- **ä¸»åœ°å›¾é¡µé¢**: http://localhost:8080
- **å¥åº·æ£€æŸ¥**: http://localhost:8080/health
- **å…·ä½“æ–‡ä»¶**: http://localhost:8080/æ–°ç–†ä¼ŠçŠæ—…æ¸¸è‡ªé©¾è·¯çº¿åœ°å›¾.html

## ğŸ“ é¡¹ç›®ç»“æ„

```
æ–°ç–†ä¼ŠçŠæ—…æ¸¸æ”»ç•¥/
â”œâ”€â”€ docker-compose.yml          # Docker Composeé…ç½®
â”œâ”€â”€ Dockerfile                  # è‡ªå®šä¹‰é•œåƒæ„å»ºæ–‡ä»¶
â”œâ”€â”€ nginx.conf                  # Nginxé…ç½®æ–‡ä»¶
â”œâ”€â”€ start.sh                    # ä¾¿æ·å¯åŠ¨è„šæœ¬
â”œâ”€â”€ README.md                   # éƒ¨ç½²è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ æ–°ç–†ä¼ŠçŠæ—…æ¸¸è‡ªé©¾è·¯çº¿åœ°å›¾.html  # ä¸»åœ°å›¾æ–‡ä»¶
â”œâ”€â”€ æ–°ç–†ä¼ŠçŠæ—…æ¸¸æ¦‚è§ˆ.html        # æ—…æ¸¸æ¦‚è§ˆ
â”œâ”€â”€ æ–°ç–†ä¼ŠçŠæ—…æ¸¸æ¦‚è§ˆ.md          # æ—…æ¸¸æ¦‚è§ˆMarkdown
â”œâ”€â”€ 2025-06-27-ç¬¬ä¸€å¤©.html      # æ¯æ—¥è¡Œç¨‹HTMLæ–‡ä»¶
â”œâ”€â”€ 2025-06-27-ç¬¬ä¸€å¤©.md        # æ¯æ—¥è¡Œç¨‹Markdownæ–‡ä»¶
â”œâ”€â”€ ...                         # å…¶ä»–æ¯æ—¥è¡Œç¨‹æ–‡ä»¶
â””â”€â”€ pictures/                   # å›¾ç‰‡èµ„æºç›®å½•
    â”œâ”€â”€ äº¤é€š/
    â”œâ”€â”€ æ™¯ç‚¹/
    â””â”€â”€ ç¾é£Ÿ/
```

## âš™ï¸ é…ç½®è¯´æ˜

### Docker Composeé…ç½®

- **é¡¹ç›®åç§°**: travel-plan
- **ç«¯å£æ˜ å°„**: 8080:80 (å¯ä¿®æ”¹æœ¬åœ°ç«¯å£)
- **å®¹å™¨åç§°**: travel-plan
- **ç½‘ç»œ**: travel-network
- **æ—¶åŒº**: Asia/Shanghai
- **é‡å¯ç­–ç•¥**: unless-stopped

### Nginxé…ç½®ç‰¹æ€§

- âœ… æ”¯æŒä¸­æ–‡æ–‡ä»¶å
- âœ… Gzipå‹ç¼©ä¼˜åŒ–
- âœ… é™æ€èµ„æºç¼“å­˜
- âœ… å®‰å…¨å¤´è®¾ç½®
- âœ… å¥åº·æ£€æŸ¥ç«¯ç‚¹
- âœ… UTF-8å­—ç¬¦é›†æ”¯æŒ

## ğŸ”§ å¸¸ç”¨å‘½ä»¤

### ä½¿ç”¨ start.sh è„šæœ¬ç®¡ç†ï¼ˆæ¨èï¼‰

```bash
# å¯åŠ¨æœåŠ¡ï¼ˆåŒ…å«ç¯å¢ƒæ£€æŸ¥å’ŒæœåŠ¡å°±ç»ªç­‰å¾…ï¼‰
./start.sh start
# æˆ–è€…ç›´æ¥è¿è¡Œ
./start.sh

# åœæ­¢æœåŠ¡
./start.sh stop

# é‡å¯æœåŠ¡
./start.sh restart

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
./start.sh status

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
./start.sh logs

# æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
./start.sh help
```

**start.sh è„šæœ¬åŠŸèƒ½ç‰¹æ€§ï¼š**
- âœ… è‡ªåŠ¨æ£€æŸ¥ Docker ç¯å¢ƒ
- âœ… ç«¯å£å ç”¨æ£€æŸ¥
- âœ… å¿…è¦æ–‡ä»¶å®Œæ•´æ€§æ£€æŸ¥
- âœ… æœåŠ¡å¥åº·çŠ¶å†µç­‰å¾…
- âœ… å½©è‰²è¾“å‡ºå’Œå‹å¥½æç¤º
- âœ… å®Œæ•´çš„è®¿é—®ä¿¡æ¯å±•ç¤º

### ä½¿ç”¨ Docker Compose ç›´æ¥ç®¡ç†

```bash
# å¯åŠ¨æœåŠ¡
docker-compose -p travel-plan up -d

# åœæ­¢æœåŠ¡
docker-compose -p travel-plan down

# é‡å¯æœåŠ¡
docker-compose -p travel-plan restart

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose -p travel-plan ps

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
docker-compose -p travel-plan logs -f travel-plan
```

### å®¹å™¨ç®¡ç†

```bash
# è¿›å…¥å®¹å™¨
docker-compose -p travel-plan exec travel-plan sh

# æŸ¥çœ‹Nginxé…ç½®
docker-compose -p travel-plan exec travel-plan nginx -t

# é‡è½½Nginxé…ç½®
docker-compose -p travel-plan exec travel-plan nginx -s reload
```

## ğŸš€ start.sh è„šæœ¬è¯¦ç»†è¯´æ˜

### è„šæœ¬åŠŸèƒ½ä»‹ç»

`start.sh` æ˜¯é¡¹ç›®æä¾›çš„ä¸€ç«™å¼éƒ¨ç½²å’Œç®¡ç†è„šæœ¬ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š

- **æ™ºèƒ½ç¯å¢ƒæ£€æŸ¥**: è‡ªåŠ¨æ£€æŸ¥ Docker å’Œ Docker Compose æ˜¯å¦æ­£ç¡®å®‰è£…
- **ç«¯å£å†²çªæ£€æµ‹**: å¯åŠ¨å‰æ£€æŸ¥ç«¯å£ 8080 æ˜¯å¦è¢«å ç”¨
- **æ–‡ä»¶å®Œæ•´æ€§æ£€æŸ¥**: ç¡®ä¿æ‰€æœ‰å¿…è¦æ–‡ä»¶å­˜åœ¨
- **å¥åº·çŠ¶æ€ç›‘æ§**: ç­‰å¾…æœåŠ¡å®Œå…¨å¯åŠ¨å¹¶è¿›è¡Œå¥åº·æ£€æŸ¥
- **å‹å¥½çš„ç”¨æˆ·ç•Œé¢**: å½©è‰²è¾“å‡ºå’Œæ¸…æ™°çš„çŠ¶æ€æç¤º
- **å®Œæ•´çš„ç®¡ç†åŠŸèƒ½**: æ”¯æŒå¯åŠ¨ã€åœæ­¢ã€é‡å¯ã€çŠ¶æ€æŸ¥çœ‹ç­‰æ“ä½œ

### ä½¿ç”¨æ–¹æ³•

```bash
# èµ‹äºˆæ‰§è¡Œæƒé™ï¼ˆé¦–æ¬¡è¿è¡Œï¼‰
chmod +x start.sh

# ä¸€é”®å¯åŠ¨ï¼ˆæ¨èæ–¹å¼ï¼‰
./start.sh

# æŸ¥çœ‹æ‰€æœ‰å¯ç”¨å‘½ä»¤
./start.sh help
```

### å‘½ä»¤å‚æ•°è¯´æ˜

| å‘½ä»¤ | åŠŸèƒ½ | è¯´æ˜ |
|------|------|------|
| `./start.sh` æˆ– `./start.sh start` | å¯åŠ¨æœåŠ¡ | æ‰§è¡Œå®Œæ•´çš„å¯åŠ¨æµç¨‹ï¼ŒåŒ…æ‹¬ç¯å¢ƒæ£€æŸ¥ |
| `./start.sh stop` | åœæ­¢æœåŠ¡ | ä¼˜é›…åœæ­¢æ‰€æœ‰å®¹å™¨ |
| `./start.sh restart` | é‡å¯æœåŠ¡ | é‡å¯å®¹å™¨æœåŠ¡ |
| `./start.sh status` | æŸ¥çœ‹çŠ¶æ€ | æ˜¾ç¤ºå½“å‰æœåŠ¡è¿è¡ŒçŠ¶æ€ |
| `./start.sh logs` | æŸ¥çœ‹æ—¥å¿— | å®æ—¶æŸ¥çœ‹æœåŠ¡æ—¥å¿— |
| `./start.sh help` | æ˜¾ç¤ºå¸®åŠ© | æ˜¾ç¤ºæ‰€æœ‰å¯ç”¨å‘½ä»¤ |

### å¯åŠ¨æµç¨‹è¯´æ˜

æ‰§è¡Œ `./start.sh` æ—¶ï¼Œè„šæœ¬ä¼šæŒ‰ä»¥ä¸‹é¡ºåºæ‰§è¡Œï¼š

1. **ğŸ” ç¯å¢ƒæ£€æŸ¥é˜¶æ®µ**
   - æ£€æŸ¥ Docker æ˜¯å¦å®‰è£…
   - æ£€æŸ¥ Docker Compose æ˜¯å¦å®‰è£…
   - æ£€æŸ¥ç«¯å£ 8080 æ˜¯å¦è¢«å ç”¨

2. **ğŸ“‹ æ–‡ä»¶æ£€æŸ¥é˜¶æ®µ**
   - éªŒè¯ `æ–°ç–†ä¼ŠçŠæ—…æ¸¸è‡ªé©¾è·¯çº¿åœ°å›¾.html` æ–‡ä»¶å­˜åœ¨
   - éªŒè¯ `docker-compose.yml` é…ç½®æ–‡ä»¶å­˜åœ¨
   - éªŒè¯ `nginx.conf` é…ç½®æ–‡ä»¶å­˜åœ¨

3. **ğŸš€ æœåŠ¡å¯åŠ¨é˜¶æ®µ**
   - åœæ­¢å¯èƒ½å­˜åœ¨çš„æ—§å®¹å™¨
   - å¯åŠ¨æ–°çš„ Docker æœåŠ¡
   - é¡¹ç›®åç§°ï¼š`travel-plan`

4. **â³ å¥åº·æ£€æŸ¥é˜¶æ®µ**
   - ç­‰å¾…æœåŠ¡å®Œå…¨å¯åŠ¨ï¼ˆæœ€å¤š 60 ç§’ï¼‰
   - æ£€æŸ¥å¥åº·æ£€æŸ¥ç«¯ç‚¹ï¼š`http://localhost:8080/health`
   - ç¡®ä¿æœåŠ¡æ­£å¸¸å“åº”

5. **âœ… å®Œæˆæç¤ºé˜¶æ®µ**
   - æ˜¾ç¤ºè®¿é—®åœ°å€å’Œç®¡ç†å‘½ä»¤
   - æä¾›åç»­ç®¡ç†å»ºè®®

### æ•…éšœæ’é™¤

å¦‚æœè„šæœ¬æ‰§è¡Œå¤±è´¥ï¼Œè¯·æ£€æŸ¥ï¼š

1. **æƒé™é—®é¢˜**
   ```bash
   chmod +x start.sh
   ```

2. **Docker æœªå®‰è£…**
   ```bash
   # macOS
   brew install docker docker-compose
   
   # Ubuntu/Debian
   sudo apt-get update
   sudo apt-get install docker.io docker-compose
   ```

3. **ç«¯å£è¢«å ç”¨**
   ```bash
   # æŸ¥çœ‹ç«¯å£å ç”¨
   lsof -i :8080
   
   # ä¿®æ”¹ docker-compose.yml ä¸­çš„ç«¯å£
   ports:
     - "8081:80"  # ä¿®æ”¹ä¸ºå…¶ä»–ç«¯å£
   ```

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

### å¥åº·æ£€æŸ¥

```bash
# æ£€æŸ¥æœåŠ¡å¥åº·çŠ¶æ€
curl http://localhost:8080/health

# æŸ¥çœ‹å®¹å™¨å¥åº·çŠ¶æ€
docker-compose -p travel-plan ps
```

### æ—¥å¿—æŸ¥çœ‹

```bash
# æŸ¥çœ‹è®¿é—®æ—¥å¿—
docker-compose -p travel-plan exec travel-plan tail -f /var/log/nginx/access.log

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
docker-compose -p travel-plan exec travel-plan tail -f /var/log/nginx/error.log
```

## ğŸ”’ å®‰å…¨é…ç½®

### å·²é…ç½®çš„å®‰å…¨å¤´

- `X-Frame-Options`: é˜²æ­¢ç‚¹å‡»åŠ«æŒ
- `X-XSS-Protection`: XSSä¿æŠ¤
- `X-Content-Type-Options`: MIMEç±»å‹å—…æ¢ä¿æŠ¤
- `Referrer-Policy`: å¼•ç”¨ç­–ç•¥
- `Content-Security-Policy`: å†…å®¹å®‰å…¨ç­–ç•¥

### å»ºè®®çš„é¢å¤–å®‰å…¨æªæ–½

1. **ä½¿ç”¨HTTPS**: åœ¨ç”Ÿäº§ç¯å¢ƒä¸­é…ç½®SSLè¯ä¹¦
2. **è®¿é—®æ§åˆ¶**: æ ¹æ®éœ€è¦é…ç½®IPç™½åå•
3. **é˜²ç«å¢™**: é…ç½®é€‚å½“çš„é˜²ç«å¢™è§„åˆ™
4. **å®šæœŸæ›´æ–°**: ä¿æŒDockeré•œåƒå’Œä¾èµ–çš„æœ€æ–°ç‰ˆæœ¬

## ğŸŒ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

### ä½¿ç”¨åå‘ä»£ç†

```nginx
# åœ¨ä¸»NginxæœåŠ¡å™¨ä¸­é…ç½®
server {
    listen 80;
    server_name travel-map.yourdomain.com;
    
    location / {
        proxy_pass http://localhost:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

### ä½¿ç”¨Traefik

Docker Composeæ–‡ä»¶ä¸­å·²åŒ…å«Traefikæ ‡ç­¾é…ç½®ï¼Œå¯ç›´æ¥ä¸Traefiké›†æˆã€‚

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ç«¯å£è¢«å ç”¨**
   ```bash
   # ä¿®æ”¹docker-compose.ymlä¸­çš„ç«¯å£æ˜ å°„
   ports:
     - "8081:80"  # æ”¹ä¸ºå…¶ä»–ç«¯å£
   ```

2. **ä¸­æ–‡æ–‡ä»¶åæ˜¾ç¤ºé—®é¢˜**
   ```bash
   # ç¡®ä¿ç³»ç»Ÿæ”¯æŒUTF-8ç¼–ç 
   locale -a | grep -i utf
   ```

3. **æƒé™é—®é¢˜**
   ```bash
   # æ£€æŸ¥æ–‡ä»¶æƒé™
   ls -la æ–°ç–†ä¼ŠçŠæ—…æ¸¸è‡ªé©¾è·¯çº¿åœ°å›¾.html
   
   # ä¿®å¤æƒé™
   chmod 644 *.html
   ```

### æ—¥å¿—åˆ†æ

```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯
docker-compose -p travel-plan logs travel-plan | grep -i error

# æŸ¥çœ‹è®¿é—®ç»Ÿè®¡
docker-compose -p travel-plan exec travel-plan \
  awk '{print $1}' /var/log/nginx/access.log | sort | uniq -c | sort -nr
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š

1. Dockerå’ŒDocker Composeç‰ˆæœ¬
2. ç«¯å£æ˜¯å¦è¢«å ç”¨
3. æ–‡ä»¶æƒé™è®¾ç½®
4. ç½‘ç»œè¿æ¥çŠ¶æ€
5. å®¹å™¨æ—¥å¿—ä¿¡æ¯

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®ä»…ç”¨äºå­¦ä¹ å’Œæ¼”ç¤ºç›®çš„ã€‚

---

**åˆ¶ä½œæ—¶é—´**: 2025å¹´7æœˆ7æ—¥  
**æŠ€æœ¯æ ˆ**: Docker + Nginx + HTML/CSS/JavaScript  
**ç»´æŠ¤è€…**: Cursor ğŸ—ºï¸âœ¨ 